\chapter{Wstęp}
Dla prostoty i przejrzystości sprawozdania wykorzystane zostały oznaczenia pierwotnie wprowadzone w skrypcie z przedmiotu STP.

\chapter{Podpunkt 1}
Sprawdzenie poprawności podanych wartości punktu pracy odbywa się poprzez zasymulowanie odpowiedzi procesu w punkcie pracy ($U_{\mathrm{pp}}$, $Y_{\mathrm{pp}}$). Z rys. \ref{Z1} widzimy, że podane wartości są poprawne - gdy na wejściu modelu podajemy $U=U_{\mathrm{pp}}=Z=Z_{\mathrm{pp}}=\num{0}$, otrzymujemy na wyjściu oczekiwaną przez nas wartość $Y=Y_{\mathrm{pp}}=\num{0}$

\begin{figure}[ht]
\centering
\input{./images/Z1}
\caption{Sprawdzenie poprawności punktu pracy}
\label{Z1}
\end{figure}


\chapter{Podpunkt 2}
Dla reprezentacji odpowiedzi skokowych wybranych zostało sześć różnych wartości zmian sygnału sterującego dla obu torów od $\triangle U = \num{-0,5}$ do $\triangle U = \num{0,5}$, w chwili $k=%FIXME$. Wykresy odpowiedzi skokowych zamieszczone zostały na rysunkach \ref{Z2a} i \ref{Z2b}.

\begin{figure}[ht]
\centering
\input{./images/Z2multipleinputsteps}
\caption{Odpowiedź dla skoków sygnału sterującego o $\triangle U = \{\num{-0,5}, \num{-0,3}, \num{-0,1}, \num{0,1}, \num{0,3}, \num{0,5}\}$}
\label{Z2a}
\end{figure}

\begin{figure}[ht]
\centering
\input{./images/Z2multiplenoisesteps}
\caption{Odpowiedź dla skoków z punktu pracy o $\triangle U = \{10, 20, 30\}$}
\label{Z2b}
\end{figure}

Symulując odpowiedź układu dla różnych wartości sygnału sterującego i zakłócającego otrzymujemy charakterystykę statyczną $y(u,z)$ widoczną na rys. \ref{Z2c}.

\begin{figure}[ht]
\centering
\input{./images/Z2staticchar}
\caption{Charakterystyka statyczna procesu $y(u,z)$}
\label{Z2c}
\end{figure}


Z odpowiedzi układu wnioskujemy, że zadany model jest %FIXME: uzupełnić odpowiednio %%% , a jego charakterystyka statyczna jest w bardzo dobrym przybliżeniu %FIXME: jaka? Obliczona wartość wzmocnienia statycznego procesu %FIXME: uzupełnić odpowiednio %%%


\chapter{Podpunkt 3}
Na potrzeby algorytmu DMC wyznaczone zostały odpowiedzi skokowe torów wejście-wejście oraz zakłócenie-wejście, obie odpowiedzi wyznaczono dla skoku jednostkowego, widoczne są odpowiednio na rysunkach \ref{Z3a} oraz \ref{Z3b}.

\begin{figure}[ht]
\centering
\input{./images/Z3inputstep}
\caption{Odpowiedź skokowa sygnału sterującego}
\label{Z3a}
\end{figure}

\begin{figure}[ht]
\centering
\input{./images/Z3noisestep}
\caption{Odpowiedź skokowa sygnału zakłócającego}
\label{Z3b}
\end{figure}


\chapter{Podpunkt 4}
Program do symulacji cyfrowej algorytmu DMC (w wersji analitycznej z zakłóceniami) dla symulowanego procesu umieszczony został w pliku \verb+DMC.m+.

Skrypt ten można w skrócie rozbić na następujące elementy:

%FIXME: Jakieś przykładowe listingi wrzuciłem tylko, zostaw co chcesz i dorzuć kilka linii komentarza.

\begin{lstlisting}[style=Matlab-editor]
%generacja macierzy
M=zeros(N,Nu);
for i=1:N
   for j=1:Nu
      if (i>=j)
         M(i,j)=s(i-j+1);
      end;
   end;
end;

Mp=zeros(N,D-1);
for i=1:N
   for j=1:D-1
      if i+j<=D
         Mp(i,j)=s(i+j)-s(j);
      else
         Mp(i,j)=s(D)-s(j);
      end;
   end;
end;

Mz=zeros(N,Dz-1);
for i=1:N
   for j=1:Dz-1
      if i+j<=Dz
         Mz(i,j)=sz(i+j)-sz(j);
      else
         Mz(i,j)=sz(Dz)-sz(j);
      end;
   end;
end;
Mz = [sz(1:N)' Mz];
\end{lstlisting} 

\begin{lstlisting}[style=Matlab-editor]
%przeksztalcanie wyliczonych macierzy do potrzebnych nam parametrow

K=((M'*M+lambda*eye(Nu))^-1)*M';
Ku=K(1,:)*Mp;
Kz=K(1,:)*Mz;
Ke=sum(K(1,:));
\end{lstlisting}

\begin{lstlisting}[style=Matlab-editor]
%glowna petla
Zpom = Z;
if szum
    Zpom = awgn(Zpom,snr); %dodaje bialy szum gaussowski o zadanym stosunku
                          %sygna³u do szumu (SNR)
end
for i=11:n

   Y(i)=symulacja_obiektu2y(U(i-5), U(i-6), Z(i-3), Z(i-4), Y(i-1), Y(i-2));

   e=Yzad(i)-Y(i); %uchyb
   err = err + e^2;

   du=Ke*e-Ku*dup'; %regulator
   if pomiar %regulator nie bierze pod uwage pomiaru zaklocen gdy pomiar=0
       du = du - Kz*dz';
   end

   for n=D-1:-1:2 %przesuniecie macierzy dUp i dZ, dodanie nowej wartosci
      dup(n)=dup(n-1);
   end
   for n=Dz:-1:2
      dz(n)=dz(n-1);
   end
   dup(1)=du;
   dz(1)=Zpom(i)-Zpom(i-1);


   U(i)=U(i-1)+dup(1); %wyliczenie nowego sterowania


end
\end{lstlisting}

%FIXME: Tu opisz jak wybrałeś "wybrane wyniki symulacji" i co z tego wynika etc.

\begin{figure}[ht]
\centering
\input{./images/Z4N25Nu8L0_05}
\caption{}
\label{Z4a}
\end{figure}
\begin{figure}[ht]
\centering
\input{./images/Z4N25Nu8L1}
\caption{}
\label{Z4b}
\end{figure}
\begin{figure}[ht]
\centering
\input{./images/Z4N25Nu20L1}
\caption{}
\label{Z4c}
\end{figure}
\begin{figure}[ht]
\centering
\input{./images/Z4N120Nu20L1}
\caption{}
\label{Z4d}
\end{figure}

%TODO: Za 5 i 6 na razie się w ogóle nie zabierałem.

\chapter{Podpunkt 5}
Wybrane przez nas regulatory oceniano jakościowo na podstawie przebiegów - preferowane były przebiegi odpowiednio gładkie, bez wyraźnych oscylacji oraz z niewielkim, bądź niewystępującym przeregulowaniem, które były bliskie do zadanego przebiegu - oraz ilościowo, zgodnie z zadanym wskaźnikiem jakości regulacji
\begin{equation}
E = \sum_{k=1}^{k_{\mathrm{konc}}}(y^{\mathrm{zad}}(k) - y(k))^2
\label{E}
\end{equation}
gdzie za koniec symulacji przyjęto $k_{\mathrm{konc}}=3000$. Wartości wyjść zadane w symulacji przedstawiono na poniższych wykresach za pomocą pomarańczowej, przerywanej linii.

Początkowe parametry regulatora PID uzyskano metodą Zieglera-Nicholsa, a następnie sprawdzano ich otoczenie i potwierdzono ich jakość. Dla regulatora DMC wybrano parametr $D=120$ oraz początkowe parametry $N=180$, $N_{\mathrm{u}}=180$, $\lambda=1$, a następnie kolejno zmniejszano je, aż do uzyskania zadowalających przebiegów.

\begin{figure}[ht]
\centering
\input{./images/Z5bezpomiaru}
\caption{}
\label{Z5a}
\end{figure}
\begin{figure}[ht]
\centering
\input{./images/Z5pomiar}
\caption{}
\label{Z5b}
\end{figure}


\chapter{Podpunkt 6}
Optymalizacja wskaźnika jakości została przeprowadzona przy użyciu skryptu zamieszczonego w pliku \verb+param_optimizer.m+, do optymalizacji globalnej wykorzystuje on funkcję \verb+ga+(algorytm genetyczny). Przy jego użyciu zmodyfikowane jednak zostały zadane wartości wyjściowe - wydłużono czasy między skokami. Bez zrobienia tego, przy symulacji regulatora z otrzymanymi parametrami układ wpadał w znaczące oscylacje - priorytetyzowane okazywało się wtedy jak najszybsze przejście do nowej wartości ze skoku ponad wygładzenie sygnału ustalonego. Wydłużenie czasów pomaga tego uniknąć, choć niejakie oscylacje nadal są widoczne w zoptymalizowanym regulatorze PID.

Przy optymalizacji algorytmem genetycznym dla obu regulatorów użyto losowych populacji (parametrów) początkowych. Program uruchomiono kilkukrotnie, uzyskując za każdym razem bardzo zbliżone wyniki. 

Ograniczenia nałożone na przeszukiwane wartości dla regulatora PID to:
\begin{equation}
	0.01 \le K, \quad
	1 \le T_\mathrm{i},\quad
	0.01 \le T_\mathrm{d}
\end{equation}

a dla regulatora DMC przy parametrze $D=120$:
\begin{equation}
	1 \le N_\mathrm{u} \le N \le 180, \quad 
	0.01 \le \lambda
\end{equation}


Dla przejrzystości wykresów zoptymalizowanych regulatorów przedstawiono na nich symulację przy przebiegu czasowym wartości zadanych wziętym z poprzedniego zadania, bez wydłużenia okresów między kolejnymi skokami.

\begin{figure}[ht]
\centering
\input{./images/Z6bezpomiaru}
\caption{Odpowiedź dla skoków z punktu pracy o $\triangle U = \{10, 20, 30\}$}
\label{Z6a}
\end{figure}
\begin{figure}[ht]
\centering
\input{./images/Z6pomiar}
\caption{Odpowiedź dla skoków z punktu pracy o $\triangle U = \{10, 20, 30\}$}
\label{Z6b}
\end{figure}
